# 股票池筛选与回测框架开发日志

## 版本历史与更新记录

本日志文件记录框架的开发过程、功能更新和运行结果，便于版本管理和后期维护。

---

# v0.1.0 (2025-03-07)

## 项目概述

本项目是一个基于Python的股票池筛选与回测框架，旨在通过技术指标（KDJ）选择符合特定条件的股票并进行回测分析。

### 功能特点

- **配置管理**：使用YAML文件存储和管理配置信息，包括股票池、指标参数等
- **数据获取**：自动从Tushare API获取股票日线数据并保存到本地
- **选股策略**：基于KDJ指标J值的选股策略，J值低于特定阈值（默认为0）视为买入信号
- **交易逻辑**：买入条件为J值低于0，卖出条件为J值首次超过70
- **回测系统**：支持等权重和市值加权两种资金分配方式
- **性能评估**：计算收益率、最大回撤等关键指标衡量策略性能

### 项目结构

```
项目目录
├── config.yaml                # 配置文件
├── requirements.txt           # 依赖列表
├── dataset/
│   └── stocktrading/         # 股票数据存储文件夹
├── src/
│   ├── main.py               # 主程序入口
│   ├── config_manager.py     # 配置管理模块
│   ├── data_fetcher.py       # 数据获取模块
│   ├── stock_selector.py     # 选股策略模块
│   └── backtest.py           # 回测模块
└── development_log.md        # 开发日志（本文件）
```

## 初始开发

### 框架搭建

- 实现了基本的配置管理模块，使用YAML文件存储配置信息
- 编写了数据获取模块，连接Tushare API获取股票数据并保存到本地
- 实现了KDJ选股策略，计算指标并根据指标值生成买入/卖出信号
- 开发了回测模块，支持等权重和市值加权两种资金分配方式
- 创建了主程序，整合各个模块功能，提供统一入口

### 关键算法

- KDJ指标计算：使用移动窗口计算KDJ指标，初始K和D值设为50
- 买入信号：J值低于0时产生
- 卖出信号：J值首次超过70时产生
- 回测逻辑：先卖出后买入，考虑交易成本和滑点

### 运行结果

*尚未执行首次回测，待运行后补充*

---

# v0.1.1 (2025-03-07)

## 优化计算方法

### KDJ计算逻辑优化

- 修改KDJ计算方法，改用加权计算替代简单移动平均
- 设置K和D的初始值为50
- 调整代码处理日期降序排列的数据，确保指标计算的准确性

## 配置调整

### Token配置优化

- 将Tushare API Token移至配置文件中
- 修改配置管理器，添加读取Token的方法
- 调整主程序逻辑，优先从配置文件读取Token，配置文件中无有效Token时才请求用户输入

## 进度可视化

### 增加进度条显示

- 添加tqdm依赖支持进度条显示
- 在数据更新过程中增加进度条，显示更新进度
- 在选股过程中增加进度条，显示KDJ计算和信号筛选进度
- 在回测过程中增加进度条，直观展示回测进度和预估完成时间

### 运行结果

*2025-03-08 回测结果*

#### 回测信息
- 回测日期：2025-03-07
- 回测策略：KDJ策略

#### 等权重策略结果
```
初始资金: 100000, 总收益率: 7.29%, 年化收益率: 7.32%, 最大回撤: -18.06%, 夏普比率: 0.45, 交易次数: 36
```

#### 市值加权策略结果
```
初始资金: 100000, 总收益率: 15.07%, 年化收益率: 15.12%, 最大回撤: -19.46%, 夏普比率: 0.92, 交易次数: 43
```

*回测结果图表已保存为 backtest_result.png*


---

**注意事项**：
1. 每次修改代码后，请更新本日志，简要说明改动内容和逻辑
2. 每次成功运行回测后，请记录回测结果
3. 重大功能更新或架构调整时，创建新的版本（一级标题）
4. 同一版本内的不同修改用二级标题区分 

---

# v0.2.0 (2023-03-08)

## 架构重构

本版本对项目架构进行了全面重构，引入了"可插拔"的模块化策略设计，提高了代码的可扩展性和灵活性。

### 目录结构优化

- 新建`strategies`目录，用于存放各类交易策略
- 新建`operators`目录，用于存放各类因子计算算子
- 新建`models`目录，用于存放机器学习模型

### 代码重构

- 将策略逻辑与指标计算分离，实现关注点分离
- 设计统一的算子输出接口，便于不同类型因子的集成
- 实现策略的依赖注入模式，策略可自定义所需算子
- 建立数据处理Pipeline，优化数据从原始数据到策略输入的流程
- 引入按需计算机制，只计算策略实际使用的算子

### 新增功能

- 技术因子算子：KDJ、MACD指标计算
- 基于LSTM的预测策略：使用价格、交易量和技术指标预测股价涨跌方向
- 数据预处理模块：包含标准化、时间序列处理等功能

### 优化项

- 改进算子计算效率，避免重复计算
- 分离模型训练与推理逻辑，便于在线/离线使用
- 设计统一的策略输出格式，便于回测系统使用

### 项目新架构

```
项目目录
├── config.yaml                # 配置文件
├── requirements.txt           # 依赖列表
├── dataset/
│   └── stocktrading/         # 股票数据存储文件夹
├── src/
│   ├── main.py               # 主程序入口
│   ├── config_manager.py     # 配置管理模块
│   ├── data_fetcher.py       # 数据获取模块
│   ├── backtest.py           # 回测模块
│   ├── operators/            # 算子文件夹
│   │   ├── __init__.py
│   │   ├── base_operator.py  # 算子基类
│   │   └── tech_operators.py # 技术指标算子
│   ├── strategies/           # 策略文件夹 
│   │   ├── __init__.py
│   │   ├── base_strategy.py  # 策略基类
│   │   ├── kdj_strategy.py   # KDJ策略
│   │   └── lstm_strategy.py  # LSTM预测策略
│   └── models/               # 模型文件夹
│       ├── __init__.py
│       ├── base_model.py     # 模型基类
│       └── lstm_model.py     # LSTM模型实现
└── development_log.md        # 开发日志（本文件）
```

### 运行结果

*2025-03-08 回测结果*

#### 回测信息
- 回测日期：2025-03-07
- 回测策略：KDJ策略

#### 等权重策略结果
```
初始资金: 100000, 总收益率: 7.29%, 年化收益率: 7.32%, 最大回撤: -18.06%, 夏普比率: 0.45, 交易次数: 36
```

#### 市值加权策略结果
```
初始资金: 100000, 总收益率: 15.07%, 年化收益率: 15.12%, 最大回撤: -19.46%, 夏普比率: 0.92, 交易次数: 43
```

*回测结果图表已保存为 backtest_result.png*
 

---

# v0.2.1 (2023-03-08)

## 模型框架调整

### 使用PyTorch重构LSTM模型

- 用PyTorch替换TensorFlow实现LSTM模型
- 改进模型架构，支持可配置的隐藏层维度和层数
- 优化保存和加载机制，支持完整的模型状态保存
- 增强数据处理流程，确保训练和预测的一致性

## 用户体验优化

### 精简进度显示

- 移除数据加载过程中的进度条显示
- 移除模型训练和预测过程中的进度条显示
- 仅保留回测阶段的进度条，提供关键流程的可视化
- 减少不必要的输出信息，使界面更加简洁

### 运行结果

*2025-03-08 回测结果*

#### 回测信息
- 回测日期：2025-03-07
- 回测策略：KDJ策略

#### 等权重策略结果
```
初始资金: 100000, 总收益率: 7.29%, 年化收益率: 7.32%, 最大回撤: -18.06%, 夏普比率: 0.45, 交易次数: 36
```

#### 市值加权策略结果
```
初始资金: 100000, 总收益率: 15.07%, 年化收益率: 15.12%, 最大回撤: -19.46%, 夏普比率: 0.92, 交易次数: 43
```

*回测结果图表已保存为 backtest_result.png*
 

---

# v0.2.2 (2023-03-08)

## 配置优化

### 策略选择配置化

- 将策略选择从命令行交互移至配置文件中
- 添加策略名称和描述字段，便于理解每个策略的用途
- 为每个策略参数添加注释，说明参数对投资逻辑的影响
- 支持通过配置文件切换KDJ和LSTM两种策略

### LSTM高级参数配置

- 将LSTM模型关键参数移至配置文件
- 添加序列长度、隐藏层维度、网络层数等参数配置
- 支持配置是否在每次预测前重新训练模型
- 提供模型保存目录配置选项

### 运行结果

*2025-03-08 回测结果*

#### 回测信息
- 回测日期：2025-03-07
- 回测策略：KDJ策略

#### 等权重策略结果
```
初始资金: 100000, 总收益率: 7.29%, 年化收益率: 7.32%, 最大回撤: -18.06%, 夏普比率: 0.45, 交易次数: 36
```

#### 市值加权策略结果
```
初始资金: 100000, 总收益率: 15.07%, 年化收益率: 15.12%, 最大回撤: -19.46%, 夏普比率: 0.92, 交易次数: 43
```

*回测结果图表已保存为 backtest_result.png*
 

---

# v0.2.3 (2023-03-08)

## 包结构优化

### 修复模块导入路径

- 将`src`目录转换为标准Python包，添加`__init__.py`文件
- 修改策略模块中的导入语句，使用相对导入替代绝对导入
- 修复`backtest.py`中的模块导入问题，使用相对导入
- 解决`ModuleNotFoundError: No module named 'src'`和`No module named 'stock_selector'`错误
- 优化整体包结构，确保模块间依赖关系清晰

### 运行方式规范

- 项目现在应从根目录运行，确保正确解析包结构
- 主要入口点保持为`python src/main.py`
- 所有子模块遵循统一的导入约定，提高代码一致性

### 运行结果

*2025-03-08 回测结果*

#### 回测信息
- 回测日期：2025-03-07
- 回测策略：KDJ策略

#### 等权重策略结果
```
初始资金: 100000, 总收益率: 7.29%, 年化收益率: 7.32%, 最大回撤: -18.06%, 夏普比率: 0.45, 交易次数: 36
```

#### 市值加权策略结果
```
初始资金: 100000, 总收益率: 15.07%, 年化收益率: 15.12%, 最大回撤: -19.46%, 夏普比率: 0.92, 交易次数: 43
```

*回测结果图表已保存为 backtest_result.png*
 

---

# v0.2.4 (2023-03-08)

## 图表优化

### 英文化图表界面

- 将回测结果图表的标题、轴标签等改为英文，提高国际兼容性
- 将"策略净值曲线"改为"Equity Curve"，"回撤曲线"改为"Drawdown Curve"
- 将等权重标签"等权重"改为"Equal Weight"，市值加权标签"市值加权"改为"Market Cap Weighted"
- 坐标轴标签"日期"、"净值"和"回撤"分别改为"Date"、"Value"和"Drawdown"

### 图片存储优化

- 创建独立的`pictures`文件夹存储回测结果图表
- 采用"<日期>_<策略>.png"的命名格式，如"20230308_KDJ.png"
- 自动在pictures文件夹不存在时创建
- 在日志中更新图表文件路径的引用

### 运行结果

*2025-03-08 回测结果*

#### 回测信息
- 回测日期：2025-03-07
- 回测策略：KDJ策略

#### 等权重策略结果
```
初始资金: 100000, 总收益率: 7.29%, 年化收益率: 7.32%, 最大回撤: -18.06%, 夏普比率: 0.45, 交易次数: 36
```

#### 市值加权策略结果
```
初始资金: 100000, 总收益率: 15.07%, 年化收益率: 15.12%, 最大回撤: -19.46%, 夏普比率: 0.92, 交易次数: 43
```

*回测结果图表已保存为 pictures/20250307_KDJ.png*
 